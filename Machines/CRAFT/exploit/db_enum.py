#!/usr/bin/env python

import pymysql
from craft_api import settings

connection = pymysql.connect(host=settings.MYSQL_DATABASE_HOST,
                             user=settings.MYSQL_DATABASE_USER,
                             password=settings.MYSQL_DATABASE_PASSWORD,
                             db=settings.MYSQL_DATABASE_DB,
                             cursorclass=pymysql.cursors.DictCursor)

try:
    with connection.cursor() as cursor:
        tables_sql = "SELECT table_schema, table_name FROM information_schema.tables WHERE table_schema != 'mysql' AND table_schema != 'information_schema'"
        cursor.execute(tables_sql)
        tables = list(map(lambda r: r["TABLE_NAME"], cursor.fetchall()))
        for table in tables:
            dump_sql = "SELECT * FROM {}".format(table)
            cursor.execute(dump_sql)
            print(cursor.fetchall())

finally:
    connection.close()

